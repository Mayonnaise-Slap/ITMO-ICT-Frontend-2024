# САНКТ-ПЕТЕРБУРГСКИЙ НАЦИОНАЛЬНЫЙ ИССЛЕДОВАТЕЛЬСКИЙ УНИВЕРСИТЕТ ИТМО

## Дисциплина: фронтенд разработка

## Отчет

Лабораторная работа 3
Разработка одностраничного веб-приложения (SPA) с использованием фреймворка Vue.JS

Выполнил: Самсонов Александр Александрович
К3343

Проверил: Добряков Д. И.

## Задача

Мигрировать ранее написанный сайт на фреймворк Vue.JS.

Минимальные требования:

- Должен быть подключён роутер
- Должна быть реализована работа с внешним API
- Разумное деление на компоненты
- Использование composable

## Ход работы

### Инициализация и настройка общих элементов интерфейса

Для стилизации сайта я выбрал реализовывать фронтенд при помощи прежде изучаемого
html-css фреймворка Bootstrap. Его экосистема готовых элементов позволила быстро
проектировать визуальную часть интерфейса для того, чтобы больше внимания уделить
логике фронтенд-приложения.

В качестве источника данных для этой работы я использовал API на основе Django Rest
Framework, который я прежде написал для дисциплины web-разработка. Он покрывает ту же
предметную область и реализовывает следующие эндпоинты:

```
/recipes
    / [GET] - получить краткую информацию о последних 10 рецептах
    / ![POST] - опубликовать рецепт
    /<pk> [GET] - получить полную информацию о рецепте
    /<pk> ![PATCH, DELETE] - crud функционал. Доступен только для автора рецепта
/comments
    / - ошибка, нельзя запрашивать все комментарии
    /?recipe_id=<pk> [GET] - получить все комментарии для конкретного рецепта
    /?recipe_id=<pk> ![POST] - опубликовать комментарий для рецепта
    /<pk> [GET] - получить полную информацию о комментарии
    /<pk> ![PATCH, DELETE] - crud функционал. Доступен только для автора комментария
/lists
    / - получить краткую информацию о всех коллекциях рецептов
    /<pk> - получить полную информацию о коллекции
/admin - админ панель
/auth - djoser аутентификация
```

Для абстракции взаимодействия с сервером я использовал следующие подходы:
1) axios instance - позволяет автоматически подставлять аутентификационный токен, 
   проще работать с путями и может обрабатывать ошибки запросов
2) использование composable модуля serverActions. Подробности - выше

Модуль serverActions реализовал следующие вспомогательные функции:
```js
async function getRequestByRef(path: string, data: vue.ref, loading: vue.ref, errors: vue.ref): void {
   /*
   утилизирует принцип pass by reference & return variable:
   мы отдаем референсы (указатели) на эти переменные и функция не должна 
   возвращать какой либо результат. Это позволяет мне сделать следующие 2 вещи:
      1) предотвратить "разрастание" асинхронности в приложении (только async 
         функция может вызвать await)
      2) передать ответственность за отслеживание статусов данных vue
   
   таким образом мне достаточно на onMounted вызвать эту функцию для нужных
   данных и vue сам будет следить за состояниями загрузки различных данных с 
   сервера. Пример ниже
   
   *initialise data and error to null and loading to true*
   onMounted(() => {
       getRequestByRef(`recipes/${recipeId}`, RecipeData, rLoading, rError)
   })
   // data will be accessed only when it is ready
   */
}

async function postComment(recipeId: number, rating: number, header: string, content: string): null | response {
    /*
    выносит логику взаимодействия с сервером за пределы компонента, он должен  только
    предоставить очищенные данные, а функция возвращает успешность выполнения процедуры.
    Так как в публикации комментария могут возникнуть проблемы только на шаге 
    валидации, а это делает html, то ошибка в выполнении означает что сервер упал. 
     */
}
function canEdit(recipeId: number) : bool {
    /*
    возвращает булево значение, если текущий пользователь может редактировать
     */
}
```

Таким образом я извлек логику взаимодействия с сервером из компонентов во внешний сервис.

Далее я создал компоненты header'а и footer'a, которые я вписал в App.vue, таким 
образом они присутствуют на всех страницах. Header активно использует второй 
composable модуль для работы с аутентификационным токеном. В зависимости от текущего 
состояния аутентификации, header меняется, предоставляя пользователю навигацию только 
туда, куда он имеет доступ. 

В заключение настройки проекта, я создал универсальный путь `/:pathMatch(.*)*`, 
который возвращает стилизованную страницу 404 для несуществующих путей с предложением 
вернуться на домашнюю страницу. 

### CRUD функционал

Приложение содержит в себе следующие ключевые сущности:
- пользователь
- рецепт
- комментарий

Далее следует описание возможностей взаимодействия с каждой из сущностей

**Пользователь**

- зарегистрировать
- войти в аккаунт
- выйти из аккаунта

**Рецепт**

- прочитать рецепт
- если автор:
  - изменить рецепт
  - удалить рецепт
- если не анонимный пользователь
  - опубликовать рецепт

**Комментарий**

Если не анонимный пользователь
- оставить комментарий для рецепта

### Реализация

Я воссоздал все выше-описанные взаимодействия в интерфейсе. Таким образом я получил 
функциональное веб-приложение, которое предоставляет удобный доступ для указанного API
Скриншоты итогового фронтенда: [отчет](https://mayonnaise-slap.github.io/ITMO_ICT_WebDevelopment_2024-2025/Lab_4/lab.html)

## Выводы

Я научился пользоваться vue для создания SPA приложений с применением роутинга и 
композиции кода. Таким образом я также изучил компонентный поход к разработке фронтенд 
приложений, а также углубил свои знания экосистемы JavaScript. 
